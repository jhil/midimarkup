(function r(t,n,e){function i(o,u){if(!n[o]){if(!t[o]){var s=typeof require=="function"&&require;if(!u&&s)return s(o,!0);if(a)return a(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(r){var n=t[o][1][r];return i(n?n:r)},f,f.exports,r,t,n,e)}return n[o].exports}var a=typeof require=="function"&&require;for(var o=0;o<e.length;o++)i(e[o]);return i})({1:[function(r,t,n){t.exports=function e(r,t){r=r||440;if(arguments.length>1)return e(r)(t);return function(t){return t>0&&t<128?Math.pow(2,(t-69)/12)*r:null}}},{}],2:[function(r,t,n){"use strict";t.exports=function(r){var t={};return function(n){if(typeof n!=="string")return null;return n in t?t[n]:t[n]=r(n)}}},{}],3:[function(r,t,n){"use strict";var e=r("../memoize");var i=r("./regex");var a={C:[0,0],D:[2,-1],E:[4,-2],F:[-1,1],G:[1,0],A:[3,-1],B:[5,-2]};t.exports=e(function(r){var t=i.exec(r);if(!t||t[5])return null;var n=a[t[1].toUpperCase()];var e=t[2].replace(/x/g,"##").length;if(t[2][0]==="b")e*=-1;var o=n[0]+7*e;if(!t[3])return[o];var u=+t[3]+n[1]-4*e;var s=t[4]?+t[4].substring(1):null;return[o,u,s]})},{"../memoize":2,"./regex":4}],4:[function(r,t,n){"use strict";t.exports=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)(\/\d+|)\s*(.*)\s*$/},{}],5:[function(r,t,n){"use strict";var e=r("music-notation/note/parse");function i(r){if((typeof r==="number"||typeof r==="string")&&r>0&&r<128)return+r;var t=Array.isArray(r)?r:e(r);if(!t||t.length<2)return null;return t[0]*7+t[1]*12+12}if(typeof t==="object"&&t.exports)t.exports=i;if(typeof window!=="undefined")window.midi=i},{"music-notation/note/parse":3}],6:[function(r,t,n){"use strict";function e(r){return r>64&&r<91?r-65:r>96&&r<123?r-71:r>47&&r<58?r+4:r===43?62:r===47?63:0}function i(r,t){var n=r.replace(/[^A-Za-z0-9\+\/]/g,"");var i=n.length;var a=t?Math.ceil((i*3+1>>2)/t)*t:i*3+1>>2;var o=new Uint8Array(a);for(var u,s,c=0,f=0,l=0;l<i;l++){s=l&3;c|=e(n.charCodeAt(l))<<18-6*s;if(s===3||i-l===1){for(u=0;u<3&&f<a;u++,f++){o[f]=c>>>(16>>>u&24)&255}c=0}}return o}t.exports=i},{}],7:[function(r,t,n){"use strict";var e=r("note-midi");t.exports=function(r,t,n){n=n||{};var i=n.gain||2;var a=n.destination||r.destination;return function(n,o,u){var s=n>0&&n<128?n:e(n);var c=t[s];if(!c)return;var f=r.createBufferSource();f.buffer=c;var l=r.createGain();l.gain.value=i;f.connect(l);l.connect(a);f.start(o);if(u>0)f.stop(o+u);return f}}},{"note-midi":5}],8:[function(r,t,n){"use strict";var e=r("./b64decode.js");t.exports=function(r,t){return new Promise(function(n,i){var a=e(t.split(",")[1]).buffer;r.decodeAudioData(a,function(r){n(r)},function(r){i("DecodeAudioData error",r)})})}},{"./b64decode.js":6}],9:[function(r,t,n){"use strict";var e=r("./load-bank");var i=r("./oscillator-player");var a=r("./buffers-player");function o(r,t){if(!(this instanceof o))return new o(r);this.nameToUrl=t||o.nameToUrl||u;this.ctx=r;this.instruments={};this.promises=[]}o.prototype.instrument=function(r,t){var n=this.ctx;r=r||"default";if(r in this.instruments)return this.instruments[r];var o={name:r,play:i(n,t)};this.instruments[r]=o;var u=e(n,this.nameToUrl(r)).then(function(r){o.play=a(n,r,t);return o});this.promises.push(u);o.onready=function(r){u.then(r)};return o};o.loadBuffers=function(r,t){var n=o.nameToUrl||u;return e(r,n(t))};function u(r){return"https://cdn.rawgit.com/gleitz/midi-js-Soundfonts/master/FluidR3_GM/"+r+"-ogg.js"}if(typeof t==="object"&&t.exports)t.exports=o;if(typeof window!=="undefined")window.Soundfont=o},{"./buffers-player":7,"./load-bank":10,"./oscillator-player":11}],10:[function(r,t,n){"use strict";var e=r("note-midi");var i=r("./decode-buffer");t.exports=function(r,t,n,e){n=n||a;e=e||o;return Promise.resolve(t).then(n).then(e).then(function(t){return{ctx:r,data:t,buffers:{}}}).then(u).then(function(r){return r.buffers})};function a(r){return new Promise(function(t,n){var e=new window.XMLHttpRequest;e.open("GET",r);e.onload=function(){if(e.status===200){t(e.response)}else{n(Error(e.statusText))}};e.onerror=function(){n(Error("Network Error"))};e.send()})}function o(r){var t=r.indexOf("MIDI.Soundfont.");t=r.indexOf("=",t)+2;var n=r.lastIndexOf(",");return JSON.parse(r.slice(t,n)+"}")}function u(r){var t=Object.keys(r.data).map(function(t){return i(r.ctx,r.data[t]).then(function(n){r.buffers[e(t)]=n})});return Promise.all(t).then(function(){return r})}},{"./decode-buffer":8,"note-midi":5}],11:[function(r,t,n){"use strict";var e=r("midi-freq")(440);var i=r("note-midi");t.exports=function(r,t){t=t||{};var n=t.destination||r.destination;var a=t.vcoType||"sine";var o=t.gain||.2;return function(t,u,s){var c=e(i(t));if(!c)return;s=s||.2;var f=r.createOscillator();f.type=a;f.frequency.value=c;var l=r.createGain();l.gain.value=o;f.connect(l);l.connect(n);f.start(u);if(s>0)f.stop(u+s);return f}}},{"midi-freq":1,"note-midi":5}],12:[function(r,t,n){"use strict";var e,i=new AudioContext,a=[],o=120,u=60/o*4,s=4,c=new Audio("/img/play.mp3"),f=new Audio("/img/stop.mp3"),l=r("soundfont-player");$(document).keydown(function(r){if(r.shiftKey&&r.keyCode==13){if($("#play-toggle").children("img").attr("src")=="/img/icon-play.svg"){f.play()}else{c.play()}e=new l(i);p();r.preventDefault()}});$("#play-toggle").on({click:function k(){c.play()}});$("#stop-toggle").on({click:function A(){f.play()}});var v=false;var p=function E(){if(v)d();else m();v=!v};var d=function O(){for(var r in a){console.log(a);a[r].stop(0)}a=[]};var m=function T(){console.log("play!");var r=$(".track").text().trim().split("\n");for(var t in r){r[t]=r[t].trim()}for(var n=0;n<r.length;n++){var e=y(r[n].trim());e=h(e);g(e)}};var g=function U(r){var t=0;for(var n=0;n<r.length;n++){(function(t){var n=r[t].key,i=r[t].timeStart,o=r[t].duration,s=r[t].instrument;if(n){var c=e.instrument(s);c.onready(function(){console.log(n+": "+i+": "+o);var r=c.play(n,i,u*o);a.push(r)})}})(n)}};var h=function D(r){var t=0;for(var n in r){var e=r[n];e.timeStart=t;t=t+u*e.duration}return r};var y=function C(r){var t=[],n=r.toUpperCase().split(" ");for(var e in n){var i=x(n[e]);if(i){i.key=w(i.key);t.push(i)}}return t};var b="acoustic_grand_piano";var x=function G(r){var t=-1,n=1;if(r.length>3){switch(r){case(r.match(/^[T][0-9]{3}\b/)||{}).input:o=parseFloat(r.substring(1));u=60/o*4;console.log("new tiempo: "+o);return;case(r.match(/(OCTAVE)[0-9]{1}\b/)||{}).input:s=parseInt(r.substring(6));return;case"PIANO":b="acoustic_grand_piano";return;case"DRUMS":b="gunshot";return;case"GUITAR":b="acoustic_guitar_steel";return;case"SAXOPHONE":b="alto_sax";return;case"TRUMPET":b="trumpet";return;case"VIOLIN":b="violin";return;case"FLUTE":b="flute";return;default:return}}for(var e in r){var i=r.charAt(e);switch(i){case"A":t=69;break;case"B":t=71;break;case"C":t=60;break;case"D":t=62;break;case"E":t=64;break;case"F":t=65;break;case"G":t=67;break;case"+":if(t===-1)return;t++;break;case"-":if(t===-1)return;t--;break;case";":t=-1;break;case"1":n=1;break;case"2":n=.5;break;case"4":n=.25;break;case"8":n=.125;break;default:return}}return{key:t,duration:n,instrument:b}};var w=function _(r){var t=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"];return t[r%12]+s}},{"soundfont-player":9}]},{},[12]);
//# sourceMappingURL=parser.js.map
